<!DOCTYPE html>  
<html lang="en">
<head>  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Frequency Calculator</title>
    <link href="StyleSheet.css" rel="stylesheet">
</head>  
<body>
    <center><img src="checkly-logo-dark.svg" alt="Checkly logo"></center>
    <h1>Check Frequency Calculator</h1>
    <div class="container">
        <div class="form-content">
            <div class="formstyle">
                <form onsubmit="return false;" name="form1">

                  <!-- Metric input section (SLA, Incidents, TTR, TTD) -->

                    <div class="input-section">
                        <div class="entry">
                            <label class="entry-label">SLA Level</label>
                            <small class="description">Target service uptime percentage</small>
                            <div class="input-group">
                                <input type="text" id="sla-level" name="sla-level">
                                <span class="unit">%</span>
                            </div>
                        </div>

                        <div class="entry">
                            <label class="entry-label">Incidents</label>
                            <small class="description">Estimated amount of incidents</small>
                            <div class="input-group">
                                <input type="text" id="incidents" name="incidents">
                                <span class="unit">per month</span>
                            </div>
                        </div>

                        <div class="entry">
                            <label class="entry-label">Time to Recovery</label>
                            <small class="description">Estimated time to resolve an incident</small>
                            <div class="input-group">
                                <input type="text" id="ttr" name="ttr">
                                <span class="unit">minute(s)</span>
                            </div>
                        </div>

                        <div class="entry">
                            <label class="entry-label">Time to Detect</label>
                            <small class="description">Maximum TTD equaling check frequency</small>
                            <div class="input-group">
                                <input type="text" id="ttd" name="ttd">
                                <span class="unit">minute(s)</span>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Result section -->

            <div class="highlight-section">
                <h2>Error Budget</h2>
                <small class="description">Remaining downtime allowance per month</small>
                <div class="frequency-result">
                    <span id="error-budget">0 min</span>
                </div>

                <br>
                <br>
                <br>

                <h2>Check Frequency</h2>
                <small class="description">The selected interval for your checks</small>
                <div class="frequency-result">
                    <span id="check-frequency">0 min</span>
                </div>
            </div>
        </div>
    </div>

</body>

</html>


<script>

function formatDuration(totalMinutes) {
    if (isNaN(totalMinutes)) return "0 min";

    let isNegative = totalMinutes < 0;
    totalMinutes = Math.abs(totalMinutes);

    // Convert minutes to total seconds 
    let totalSeconds = Math.round(totalMinutes * 60);
    const days = Math.floor(totalSeconds / (24 * 3600));
    totalSeconds %= 24 * 3600;
    const hours = Math.floor(totalSeconds / 3600);
    totalSeconds %= 3600;
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;

    // Build the formatted string
    let parts = [];
    if (days > 0) parts.push(`${days}d`);
    if (hours > 0) parts.push(`${hours}h`);
    if (minutes > 0) parts.push(`${minutes}m`);
    if (seconds > 0) parts.push(`${seconds}s`);
    
    // If all parts are zero, display "0 min"
    if (parts.length === 0) {
        parts.push("0 min");
    }

    let formattedDuration = parts.join(' ');

    if (isNegative) {
        formattedDuration = `-${formattedDuration}`;
    }

    return formattedDuration;
}

function calculate() {
    // Retrieve input values
    let slaLevel = parseFloat(document.getElementById('sla-level').value);
    let incidentsInput = document.getElementById('incidents').value;
    let ttr = parseFloat(document.getElementById('ttr').value);
    let ttd = parseFloat(document.getElementById('ttd').value);

    // Total minutes in a 30-day month
    const totalMinutesPerMonth = 30 * 24 * 60;

    // Initialize errorBudget and checkFrequency
    let errorBudget = 0;
    let checkFrequency = 0;

    // Validate slaLevel and calculate Error Budget if valid
    if (!isNaN(slaLevel) && slaLevel > 0 && slaLevel < 100) {
        // Calculate initial Error Budget based on SLA Level
        errorBudget = ((100 - slaLevel) / 100) * totalMinutesPerMonth;

        // Validate and set incidents to 1 if input is empty
        let incidents = parseInt(incidentsInput);
        if (incidentsInput.trim() === '') {
            incidents = 1;
        } else if (isNaN(incidents) || incidents < 0) {
            incidents = 1;
        }

        // Validate TTR and TTD
        if (isNaN(ttr) || ttr < 0) ttr = 0;
        if (isNaN(ttd) || ttd < 0) ttd = 0;

        // Subtract time consumed by incidents (TTR + TTD per incident)
        errorBudget -= incidents * (ttr + ttd);

        // Set Check Frequency equal to TTD
        checkFrequency = ttd;
    } else {
        // If slaLevel is invalid, set Error Budget and Check Frequency to zero
        errorBudget = 0;
        checkFrequency = 0;
    }

    // Format the Error Budget
    const formattedErrorBudget = formatDuration(errorBudget);

    // Format the Check Frequency
    let formattedCheckFrequency;
    if (checkFrequency % 1 === 0) {
        // If it's a whole number, display without decimals
        formattedCheckFrequency = `${checkFrequency} min`;
    } else {
        // Display with one decimal place
        formattedCheckFrequency = `${checkFrequency.toFixed(1)} min`;
    }

    // Display the results
    const errorBudgetElement = document.getElementById('error-budget');
    errorBudgetElement.innerText = formattedErrorBudget;

    // Change text color based on whether the Error Budget is negative
    if (errorBudget < 0) {
        errorBudgetElement.classList.add('negative-budget');
    } else {
        errorBudgetElement.classList.remove('negative-budget');
    }

    document.getElementById('check-frequency').innerText = formattedCheckFrequency;
}


// Event listeners to recalculate when inputs change
document.getElementById('sla-level').addEventListener('input', calculate);
document.getElementById('incidents').addEventListener('input', calculate);
document.getElementById('ttr').addEventListener('input', calculate);
document.getElementById('ttd').addEventListener('input', calculate);

// Initial calculation when the page loads
calculate();

  </script>
</body>
</html>
